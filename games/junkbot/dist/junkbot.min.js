/*! junkbot 20-07-2016 */
function vector2d(a,b,c,d){this.x1=a,this.y1=b,this.x2=c,this.y2=d,this.length=function(){return Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2))},this.normalizeDX=function(){return 0==this.length()?0:(this.x2-this.x1)/this.length()},this.normalizeDY=function(){return 0==this.length()?0:(this.y2-this.y1)/this.length()},this.angleRadians=function(){return 0==this.length()||this.x1-this.x2==0?0:Math.atan2(this.y2-this.y1,this.x2-this.x1)}}function bullet(){this.x=robot.x+robot.width/2,this.y=robot.y-70,this.vector=new vector2d(this.x,this.y,probe.x,probe.y)}var WIDTH=920,HEIGHT=500,robotImage=new Image;robotImage.src="media/robot.png";var bg=document.getElementById("bg_layer");bg.width=WIDTH,bg.height=HEIGHT;var bgctx=bg.getContext("2d");bgctx.fillStyle="#ddddff",bgctx.fillRect(0,0,bg.width,bg.height);var canvas=document.getElementById("robot_layer");canvas.width=WIDTH,canvas.height=HEIGHT;var ctx=canvas.getContext("2d"),ground=bg.height-20,mouseX=50,mouseY=50,robot={speed:256,x:50,y:ground,height:100,width:95,h:30,w:20},probe={speed:5,health:100,radius:40,x:100,y:100},bullets=[],bulletVel=500,bulletDam=5,keysDown={};addEventListener("keydown",function(a){keysDown[a.keyCode]=!0},!1),addEventListener("keyup",function(a){delete keysDown[a.keyCode]},!1),canvas.addEventListener("mousemove",function(a){var b=canvas.getBoundingClientRect();mouseX=a.clientX-b.left,mouseY=a.clientY-b.top}),canvas.addEventListener("click",function(a){bullets.push(new bullet)}),canvas.onselectstart=function(){return!1};var update=function(a){37 in keysDown&&(robot.x-=robot.speed*a),39 in keysDown&&(robot.x+=robot.speed*a),probe.x+=(mouseX-probe.x)*probe.speed*a,probe.y+=(mouseY-probe.y)*probe.speed*a;var b=bullets.length;for(ndx=0;ndx<b;ndx++){var c=bullets.shift();c.x+=c.vector.normalizeDX()*a*bulletVel,c.y+=c.vector.normalizeDY()*a*bulletVel,c.x<canvas.width&&c.y<canvas.height&&c.x>0&&c.y>0&&(c.x<probe.x+probe.radius&&c.x>probe.x-probe.radius&&c.y<probe.y+probe.radius&&c.y>probe.y-probe.radius?(probe.health-=bulletDam,probe.health<0&&(probe.health=0)):bullets.push(c))}},render=function(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="#FF0000",bullets.forEach(function(a){ctx.fillRect(a.x,a.y,10,10)});var a=new vector2d(robot.x+robot.width/2,robot.y-robot.height,probe.x,probe.y);ctx.translate(robot.x+robot.width/2,robot.y-robot.height),ctx.drawImage(robotImage,220,5,198,222,-robot.width/2,0,robot.width,robot.height),ctx.rotate(a.angleRadians()),robot.x>probe.x?(ctx.translate(0,30),ctx.drawImage(robotImage,188,237,173,97,-robot.width/2,-40,robot.width,robot.height/2),ctx.translate(0,-30)):ctx.drawImage(robotImage,5,237,173,97,-robot.width/2,-40,robot.width,robot.height/2),ctx.rotate(-a.angleRadians()),ctx.translate(0,30),ctx.rotate(a.angleRadians()),ctx.drawImage(robotImage,5,5,205,93,-15,-15,robot.width/1.3,robot.height/2.8),ctx.rotate(-a.angleRadians()),ctx.translate(0,-30),ctx.translate(-(robot.x+robot.width/2),-(robot.y-robot.height)),ctx.fillStyle="#555555",ctx.beginPath(),ctx.arc(probe.x,probe.y,probe.radius,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.fillStyle="#33d6ff",ctx.arc(probe.x,probe.y,35,0,probe.health/100*2*Math.PI),ctx.lineTo(probe.x,probe.y),ctx.fill(),ctx.stroke()},main=function(){var a=Date.now(),b=a-then;update(b/1e3),render(),then=a,requestAnimationFrame(main)},then=Date.now();main();